name: truyenhot_backend_notify

on:
  workflow_run:
    workflows: ['truyenhot_backend_deploy']
    types:
      - completed

jobs:
  notify_success:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Install dependencies
        run: |
          npm install moment-timezone

      - name: Notify Discord Success
        uses: actions/github-script@v7
        with:
          script: |
            const moment = require('moment-timezone');
            const now = moment().tz('Asia/Ho_Chi_Minh').format('YYYY-MM-DD HH:mm:ss'); // MÃºi giá» HÃ  Ná»™i
            const {DISCORD_WEBHOOK_URL, COMMIT_MESSAGE, REPOSITORY, MESSAGE} = process.env;
            const message = {
              content: `ğŸš€ ğŸš€ ğŸš€\n\nğŸ“ **Repository:** ${REPOSITORY}\n\nğŸ“ **Commit Message:** *"${COMMIT_MESSAGE}"*\n\nâœ… **Status:** *"Success"*\n\nğŸ“… **Date:** ${now}\n\nğŸ“£ **Message:** *"${MESSAGE}"*`
            };
            await fetch(DISCORD_WEBHOOK_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(message)
            });
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MESSAGE: ${{ github.event.workflow_run.head_commit.message }}
          REPOSITORY: ${{ github.event.repository.name }}
          MESSAGE: ${{ github.actor }} Ä‘Ã£ deploy thÃ nh cÃ´ng ğŸ‘.

  notify_fail:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - name: Install dependencies
        run: |
          npm install moment-timezone

      - name: Notify Discord Failure
        uses: actions/github-script@v7
        with:
          script: |
            const moment = require('moment-timezone');
            const now = moment().tz('Asia/Ho_Chi_Minh').format('YYYY-MM-DD HH:mm:ss'); // MÃºi giá» HÃ  Ná»™i
            const {DISCORD_WEBHOOK_URL, COMMIT_MESSAGE, REPOSITORY, MESSAGE} = process.env;
            const message = {
              content: `ğŸ”´ ğŸ”´ ğŸ”´\n\nğŸ“ **Project:** ${REPOSITORY}\n\nğŸ“ **Commit Message:** *"${COMMIT_MESSAGE}"*\n\nâŒ **Status:** *"Fail"*\n\nğŸ“… **Date:** ${now}\n\nğŸ“£ **Message:** *"${MESSAGE}"*`
            };
            await fetch(DISCORD_WEBHOOK_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(message)
            });
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MESSAGE: ${{ github.event.workflow_run.head_commit.message }}
          REPOSITORY: ${{ github.event.repository.name }}
          MESSAGE: ${{ github.actor }} Ä‘Ã£ gáº·p lá»—i khi deploy ğŸ˜¢
